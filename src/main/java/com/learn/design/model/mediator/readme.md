中介者模式:

中介者模式是通过创建一个中介者, 来管理众多对象的交错的复杂关系, 并通过将蜘蛛网的结构转换为星型结构的依赖

[toc]
# 中介者模式
## 定义
中介者的定义为:
> Define an object that encapsulates how a set of objects interact. Meidator promotes loose coupling by keeping objects from referring to each other explicitly, and it lets you vary their interaction independently;(用一个中介者封装一些列的对象的交互, 中介者使个对象不需要显示地交互作用，从而使其耦合松散，而且可以独立地改变它们之间的交互。)

中介者模式的通用类图:
```
graph BT
Mediator --> Colleague
ConcreteMediator --> Mediator
```

## 角色定义
- Mediator 抽象中介者角色

抽象中介者角色定义统一的接口, 用于各同事之间的通信.

- Concrete Mediator 具体中介者角色

具体中介者角色通过协调各同事角色实现协作行为, 因此它必须依赖于各个同事角色。

- Colleague同事角色

每一个同事角色都知道中介者角色, 而且与其他同事角色通信的时候，一定要通过中介者角色协作.每个同事类分为两种:
- 同事本身的行为
> 比如改变对象本身的状态, 处理自己的行为等. 这种方法叫做自发行为(self-Method), 与其他的同事类或中介者没有任何的依赖。

- 必须依赖中介者才能完成的行为，叫做依赖方法(Dep-Method)
- 

## 中介者模式的应用
### 中介者模式的优点
中介者模式的有点就是减少类间的依赖, 把原有的一对多的依赖编程了一对一的依赖，同事类只依赖中介者, 减少了依赖, 当然同时也降低了类间的耦合.

### 中介者模式是的缺点
中介者模式的缺点就是中介者会膨胀得很大, 而且逻辑复杂, 原本N个对象直接的相互依赖关系转换为中介者和同事类的依赖关系, 同事类越多, 中介者的逻辑就汇越复杂.

### 中介者的使用场景
中介者模式简单, 但是简单不代表容易使用, 很容易被误用。在面向对象的编程中，对象和对象之间必然有依赖关系, 如果某个类和其他类没有任何依赖关系，那这个类就是一个"孤岛", 在项目中就没有存在的必要了。就像是某个人如果永远独立生活，与任何人都没有关系，那这个人基本上就算是野人了。

类之间的依赖关系是必然存在的，一个类依赖多个类的情况也是存在的，存在即合理，那是否可以说是只要有多个依赖关系就考虑使用中介者模式呢?答案是否定的。中介者模式未必能帮你吧原本凌乱的逻辑整理得清清楚楚。而且中介者模式也是有缺点的，这个缺点在使用不当时会被放大，比如原本就简单的几个对象的依赖关系，如果为了使用模式而加入中介者, 必然导致中介者的逻辑复杂化，因此中介者模式的使用需要"量力而行".

中介者模式适用于多个对象之间紧密耦合关系的情况, 紧密耦合标准是:`在类图中出现了蜘蛛网状结构`.

在这种情况下一定要使用中介者模式, 有力于把蜘蛛网梳理为星状结构, 把原本复杂混乱的关系变得清晰简单.

## 中介者模式的实际应用
中介者模式也叫做调停者模式, 一个对象要和N多个对象交流。

- 机场调度中心

大家现在都会看到""XXX机场调用中心", 这就是一个中介者, 用来调用飞机的降落和起飞.

- MVC框架

MVC框架, 其中的C(Controller)就是一个中介者, 叫做前端控制器, 它的作用就是把M(Model， 业务逻辑)和V (View, 视图)隔离开, 协调M和V协同工作，把M运行的结果和V代表的视图融合为一个前端可以展示的界面，减少M和V的依赖关系。

- 媒体网关

媒体网关也是一个典型的中介者模式，用户将消息发送到服务器上, 并由服务器将消息转发给其他人使用。 这就是使用了一个中介者模式.

- 中介服务

现在中介非常多，比如房屋中介, 出国中介, 这些也是中介模式的具体体现。

## 最佳实践
中介者模式很少用到接口或者抽象类，这是与依赖倒置原则是冲突的。
- 同事类，是代表了类之间是协作关系，完成不同的任务，处理不同的业务，所以不能再抽象类或接口中严格定义同事类必须具有的方法。如果两个类不能提炼出共性, 那就不要刻意去追求两者的抽象，抽象只要定义出模式需要的角色即可.
- 其次, 在一个项目中，中介者模式可能被多个模式采用，每个中介者所围绕的同事类各部相同，你能抽象出一个具有共性的中介者吗？很难, 一个中介者抽象类一般只有一个实现者 ，除非中介者逻辑非常复杂，代码量非常大，这时才会出现多个中介者的情况。

所以对于中介者来说, 抽象已经没有太多的必要。